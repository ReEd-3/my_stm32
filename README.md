# my_stm32

## Tips

- 2025.11.04  
    1. keil无法对**国产芯片**识别，可以连接但不能烧录。  
    2. stm32f1c103c8t6默认LED连接PC13(或PB12)。  

- 2025.11.05  
    1. 保证电路处处通路，尤其是排针与系统板接触。  
    2. 四脚按键同侧两脚相连  

- 2025.11.06  
    1. PWM含有三个重要参数  
        - 频率  
        - 周期  
        - 占空比  
    2. PWM可以通过控制**高低电平占比**来控制LED亮度  
    3. 呼吸灯的流畅程度和arr有很大关系  
    4. ccr的数值决定了PWM的占空比  
    5. **duty**(占空比)和arr,ccr之间满足**ccr = duty * (arr+1)**  

- 2025.11.07
    1. 舵机旋转的流畅程度也和arr有很大关系
    2. PWM信号频率 = 时钟频率 ÷ psc ÷ arr (这表明了arr越PWM信号频率越小输出越不流畅)  

- 2025.11.08
    1. 按键控制中GPIO_INPUT需要设置为**上拉(Pull up)**
    2. 编写大型工程时将**功能模块化**很重要，边编写边测试，可以利用默认LED指示灯用于测试
    3. 为程序设置**状态机**可以有效实现对复杂情况的处理
    4. 对双击操作进行消抖时要保证第二次点击充分消抖防止双击后单击

- 2025.11.09
    1. stm32系统板上的**TX，RX**分别和USB转TTL上的**RXD，TXD**连接
    2. 非阻塞中使用**HAL\_TIM\_PeriodElapsedCallback(TIM\_HandleTypeDef \*htim)**
    和**HAL\_UART\_TxCpltCallback(UART\_HandleTypeDef \*huart)**进行回调函数调用（计时器arr每溢出一次进行一次回调）
    3. 阻塞编程中需要设置**timeout**防止程序被一直截断

## Files

### 基础外设掌控（硬件交互）

1. LED001
    - 实验性工程，PB8以1Hz实现高低电平翻转  

2. LED002
    - 实验性工程，PC13和PB12以1Hz实现高低电平翻转  

3. LED003
    - 开关连接PB8控制LED的点亮和熄灭，使开关按下一次LED转换一次状态，  
    PC13控制默认LED的状态使开关按下时默认LED熄灭，其余时刻点亮  

4. Breath_LED  
    - 呼吸灯，使LED亮度随着时间成正弦变化，代码块中使用for循环和delay使时间i递增,  
    用sin函数计算渐亮时的ccr，cos函数计算渐暗时的ccr  

5. Servo_control
    - 舵机控制，通过PWM控制舵机旋转到0°，90°，180°，间隔1s  
    - 还可以通过for循环控制舵机的转动速度（见while循环中注释掉的代码）

6. SERVO_KEY  
    - 按键实现舵机特定角度的控制，为按键状态和事件状态设置了多种状态
    - 执行过程可分为
        1. 检测**按键状态**
        2. 根据**按键状态**设置不同的**按键事件**
        3. 根据**按键事件**进行**舵机位置**的控制
        4. 根据舵机位置输出相应的**PWM**

### 串口通信与优化（人机交互）

1. USART
    - 简单的串口通信，程序执行时使用**HAL_UART_Transmit_IT(&huart1, 字符串名称, 字符串长度，timeout)**阻塞的方法发**送"hello world"**

2. Time_Transmit
    - 根据时钟进行时间数据的传输，每**1/10秒**传输一次系统时间，
    - 执行过程分为
        1. **时钟2**进行回调时，**系统时间**+1，**时钟状态**变为可用
        2. **USART1**进行回调时，**串口状态变**为可用
        3. 如果**时钟状态**和**串口状态**均可用，则计算出时分秒的数值，**格式化字符**串生成时间，并发送